{% extends "base.html"%}
{% block title %} Attendance Log {% endblock %}

{% block content %}
<header>
    <h2 id="pageTitle">ðŸ“‹ Attendance Log & Marking</h2>
    <div class="controls">
        <a href="{{ url_for('attendance.start_attendance_session') }}">
            <button class="btn btn-primary">
                ðŸŽ¥ Start Live Attendance Session
            </button>
        </a>
    </div>
</header>

<div class="card">
    <h3>Attendance Records History</h3>

    {% if records %}
    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Roll No.</th>
                    <th>Student Name</th>
                    <th>Time In</th>
                    <th>Time Out</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for record in records %}
                <tr>
                    <td>{{ record.time_in.strftime('%Y-%m-%d') }}</td>
                    <td>{{ record.roll_no }}</td>
                    <td>{{ record.name }}</td>
                    
                    <td>{{ record.time_in.strftime('%H:%M:%S') }}</td>
                    
                    <td>
                        {% if record.time_out %}
                            {{ record.time_out.strftime('%H:%M:%S') }}
                        {% else %}
                            â€”
                        {% endif %}
                    </td> 
                    
                    <td>
                        {% if record.status == 'Late' %}
                            <span style="color: orange; font-weight: bold;">LATE</span>
                        {% elif record.status == 'Present' %}
                            <span style="color: green;">PRESENT</span>
                        {% elif record.status == 'Absent' %}
                            <span style="color: red; font-weight: bold;">ABSENT</span>
                        {% else %}
                            {{ record.status }}
                        {% endif %}
                    </td> 
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p style="text-align: center; color: var(--text-secondary);">No attendance records found yet.</p>
    {% endif %}
</div>

---

<div style="margin-top: 30px; text-align: center; padding: 20px;">
    <p style="margin-bottom: 15px;">After the final cut-off time, use this button to mark all students who lack a record:</p>
    
    <form method="POST" action="{{ url_for('attendance.mark_absentees') }}" style="display:inline-block;">
        <button type="submit" class="btn" style="background: var(--accent-danger);"
                onclick="return confirm('WARNING: Are you sure you want to mark all uncounted students as ABSENT for today? This cannot be easily undone.');">
            ðŸ‘» Finalize Absentees for Today
        </button>
    </form>
</div>


{% endblock %}